# DDDサンプル

敢えてドメイン知識が漏れているサンプルを作りました。

あるアプリケーションにおいてユーザーに対してメルマガを送信する管理画面を作りました。

メール送信画面には、都道府県のチェックボックスがついており、ユーザーが住んでいる特定の都道府県（複数送信可）のみに対して送信することが出来ます。

もちろん全部チェックして全県に送信する事もできますし、何もユーザーが県のフィルターを選択してなかったら全件送信です。

よくありそうなコードですがどこがドメイン知識が漏れているでしょうか。

## 注意

[松原さんがZenで示されてるように](https://zenn.dev/praha/articles/92c6494570a4dc)ドメインオブジェクトやバリューオブジェクトをレポジトリとかで利用することで「漏れてる」としてもよかったのですが（・・・というかそっちの方が例として簡単でしたが）今回は違います。
うっかりロジック的な面です。

## ディレクトリ
```
.
├── domain ドメイン層
│   ├── base
│   │   └── Entity.ts
│   ├── entity　エンティティ
│   │   └── UserEntity.ts
│   ├── error　ドメインエラー
│   │   └── Error.ts
│   ├── interface インターフェース
│   │   └── IUserRepository.ts
│   └── valueobject　バリューオブジェクト
│       ├── PrefectureValue.ts
│       └── base
│           └── ValueObject.ts
├── repository　インフラ層リポジトリ実装
│   └── UserSaveRepository.ts
└── usecase　　　ユースケース層
    └── UserEmailUsecase.ts
```

##　正解

考え方にもよるかもしれませんが、今のままだと、レポジトリfindAll(prefectures?: string[])を実装する際、

- prefectureが無いなら「全件送信」

というのを知っていないと実装出来ません。

引数からなんとなく想像できますが、しかしもしかしたらprefecturesで空の配列がわたってきた時は空配列を渡すべきかもしれませんし、それはレポジトリが知っているべきことではありません。

上述のロジックはドメイン知識に属するのでせめてfindAllではprefecturesを必ず取り、Usecase層で引数を渡すことでハンドリングするべきです。


・・・ちなみに今回のコードですごく厳密に言うと

- レポジトリがUserエンティティを知ってるのはおかしいのでは（返してるのでDTOで返すべきでは）

とか

- ユースケースがPrefectureを知ってるのはおかしいのでは

ということもできると思います。

正直これもある意味ドメイン知識が漏れてると言えると思います。

ただレポジトリインターフェースやユースケース層もドメインに含めて考えることも多くて今回はライトなDDDということにしました。